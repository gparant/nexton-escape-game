class P{constructor(e){this.properties=e??[]}get(e){const r=this.properties.filter(o=>o.name===e).map(o=>o.value);if(r.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(r.length!==0)return r[0]}getString(e){return this.getByType(e,"string")}getNumber(e){return this.getByType(e,"number")}getBoolean(e){return this.getByType(e,"boolean")}getByType(e,r){const o=this.get(e);if(o!==void 0){if(r!=="json"&&typeof o!==r)throw new Error('Expected property "'+e+'" to have type "'+r+'"');return o}}mustGetString(e){return this.mustGetByType(e,"string")}mustGetNumber(e){return this.mustGetByType(e,"number")}mustGetBoolean(e){return this.mustGetByType(e,"boolean")}mustGetByType(e,r){const o=this.get(e);if(o===void 0)throw new Error('Property "'+e+'" is missing');if(r!=="json"&&typeof o!==r)throw new Error('Expected property "'+e+'" to have type "'+r+'"');return o}getType(e){const r=this.properties.filter(o=>o.name===e).map(o=>o.type);if(r.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(r.length!==0)return r[0]}}const N="https://unpkg.com/@workadventure/scripting-api-extra@1.5.0/dist";class le{constructor(e){this.name=e.name,this.x=e.x,this.y=e.y,this.properties=new P(e.properties)}get isReadable(){const e=this.properties.getString("readableBy");return e?WA.player.tags.includes(e):!0}get isWritable(){const e=this.properties.getString("writableBy");return e?WA.player.tags.includes(e):!0}}function U(t){const e=t?"#"+t.join():"";WA.nav.openCoWebSite(N+"/configuration.html"+e)}async function ce(t,e){const r=await WA.room.getTiledMap(),o=new Map;return Z(r.layers,o,t,e),o}function Z(t,e,r,o){for(const a of t)if(a.type==="objectgroup"){for(const n of a.objects)if(n.type==="variable"||n.class==="variable"){if(r&&a.name!==r||o&&!o.includes(n.name))continue;e.set(n.name,new le(n))}}else a.type==="group"&&Z(a.layers,e,r,o)}let V;async function E(){return V===void 0&&(V=pe()),V}async function pe(){return fe(await WA.room.getTiledMap())}function fe(t){const e=new Map;return ee(t.layers,"",e),e}function ee(t,e,r){for(const o of t)o.type==="group"?ee(o.layers,e+o.name+"/",r):(o.name=e+o.name,r.set(o.name,o))}async function te(){const t=await E(),e=[];for(const r of t.values())if(r.type==="objectgroup")for(const o of r.objects)(o.type==="area"||o.class==="area")&&e.push(o);return e}function me(t){let e=1/0,r=1/0,o=0,a=0;const n=t.data;if(typeof n=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let s=0;s<t.height;s++)for(let i=0;i<t.width;i++)n[i+s*t.width]!==0&&(e=Math.min(e,i),a=Math.max(a,i),r=Math.min(r,s),o=Math.max(o,s));return{top:r,left:e,right:a+1,bottom:o+1}}function re(t){let e=1/0,r=1/0,o=0,a=0;for(const n of t){const s=me(n);s.left<e&&(e=s.left),s.top<r&&(r=s.top),s.right>a&&(a=s.right),s.bottom>o&&(o=s.bottom)}return{top:r,left:e,right:a,bottom:o}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var ge=Object.prototype.toString,T=Array.isArray||function(e){return ge.call(e)==="[object Array]"};function D(t){return typeof t=="function"}function de(t){return T(t)?"array":typeof t}function z(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function _(t,e){return t!=null&&typeof t=="object"&&e in t}function be(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var he=RegExp.prototype.test;function ye(t,e){return he.call(t,e)}var Ae=/\S/;function We(t){return!ye(Ae,t)}var ve={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function we(t){return String(t).replace(/[&<>"'`=\/]/g,function(r){return ve[r]})}var Pe=/\s*/,Ce=/\s+/,F=/\s*=/,Te=/\s*\}/,Se=/#|\^|\/|>|\{|&|=|!/;function Le(t,e){if(!t)return[];var r=!1,o=[],a=[],n=[],s=!1,i=!1,u="",f=0;function g(){if(s&&!i)for(;n.length;)delete a[n.pop()];else n=[];s=!1,i=!1}var h,A,k;function S(v){if(typeof v=="string"&&(v=v.split(Ce,2)),!T(v)||v.length!==2)throw new Error("Invalid tags: "+v);h=new RegExp(z(v[0])+"\\s*"),A=new RegExp("\\s*"+z(v[1])),k=new RegExp("\\s*"+z("}"+v[1]))}S(e||b.tags);for(var m=new x(t),W,p,y,L,R,w;!m.eos();){if(W=m.pos,y=m.scanUntil(h),y)for(var B=0,ue=y.length;B<ue;++B)L=y.charAt(B),We(L)?(n.push(a.length),u+=L):(i=!0,r=!0,u+=" "),a.push(["text",L,W,W+1]),W+=1,L===`
`&&(g(),u="",f=0,r=!1);if(!m.scan(h))break;if(s=!0,p=m.scan(Se)||"name",m.scan(Pe),p==="="?(y=m.scanUntil(F),m.scan(F),m.scanUntil(A)):p==="{"?(y=m.scanUntil(k),m.scan(Te),m.scanUntil(A),p="&"):y=m.scanUntil(A),!m.scan(A))throw new Error("Unclosed tag at "+m.pos);if(p==">"?R=[p,y,W,m.pos,u,f,r]:R=[p,y,W,m.pos],f++,a.push(R),p==="#"||p==="^")o.push(R);else if(p==="/"){if(w=o.pop(),!w)throw new Error('Unopened section "'+y+'" at '+W);if(w[1]!==y)throw new Error('Unclosed section "'+w[1]+'" at '+W)}else p==="name"||p==="{"||p==="&"?i=!0:p==="="&&S(y)}if(g(),w=o.pop(),w)throw new Error('Unclosed section "'+w[1]+'" at '+m.pos);return Ee(Me(a))}function Me(t){for(var e=[],r,o,a=0,n=t.length;a<n;++a)r=t[a],r&&(r[0]==="text"&&o&&o[0]==="text"?(o[1]+=r[1],o[3]=r[3]):(e.push(r),o=r));return e}function Ee(t){for(var e=[],r=e,o=[],a,n,s=0,i=t.length;s<i;++s)switch(a=t[s],a[0]){case"#":case"^":r.push(a),o.push(a),r=a[4]=[];break;case"/":n=o.pop(),n[5]=a[2],r=o.length>0?o[o.length-1][4]:e;break;default:r.push(a)}return e}function x(t){this.string=t,this.tail=t,this.pos=0}x.prototype.eos=function(){return this.tail===""};x.prototype.scan=function(e){var r=this.tail.match(e);if(!r||r.index!==0)return"";var o=r[0];return this.tail=this.tail.substring(o.length),this.pos+=o.length,o};x.prototype.scanUntil=function(e){var r=this.tail.search(e),o;switch(r){case-1:o=this.tail,this.tail="";break;case 0:o="";break;default:o=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=o.length,o};function C(t,e){this.view=t,this.cache={".":this.view},this.parent=e}C.prototype.push=function(e){return new C(e,this)};C.prototype.lookup=function(e){var r=this.cache,o;if(r.hasOwnProperty(e))o=r[e];else{for(var a=this,n,s,i,u=!1;a;){if(e.indexOf(".")>0)for(n=a.view,s=e.split("."),i=0;n!=null&&i<s.length;)i===s.length-1&&(u=_(n,s[i])||be(n,s[i])),n=n[s[i++]];else n=a.view[e],u=_(a.view,e);if(u){o=n;break}a=a.parent}r[e]=o}return D(o)&&(o=o.call(this.view)),o};function d(){this.templateCache={_cache:{},set:function(e,r){this._cache[e]=r},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}d.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};d.prototype.parse=function(e,r){var o=this.templateCache,a=e+":"+(r||b.tags).join(":"),n=typeof o<"u",s=n?o.get(a):void 0;return s==null&&(s=Le(e,r),n&&o.set(a,s)),s};d.prototype.render=function(e,r,o,a){var n=this.getConfigTags(a),s=this.parse(e,n),i=r instanceof C?r:new C(r,void 0);return this.renderTokens(s,i,o,e,a)};d.prototype.renderTokens=function(e,r,o,a,n){for(var s="",i,u,f,g=0,h=e.length;g<h;++g)f=void 0,i=e[g],u=i[0],u==="#"?f=this.renderSection(i,r,o,a,n):u==="^"?f=this.renderInverted(i,r,o,a,n):u===">"?f=this.renderPartial(i,r,o,n):u==="&"?f=this.unescapedValue(i,r):u==="name"?f=this.escapedValue(i,r,n):u==="text"&&(f=this.rawValue(i)),f!==void 0&&(s+=f);return s};d.prototype.renderSection=function(e,r,o,a,n){var s=this,i="",u=r.lookup(e[1]);function f(A){return s.render(A,r,o,n)}if(u){if(T(u))for(var g=0,h=u.length;g<h;++g)i+=this.renderTokens(e[4],r.push(u[g]),o,a,n);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")i+=this.renderTokens(e[4],r.push(u),o,a,n);else if(D(u)){if(typeof a!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(r.view,a.slice(e[3],e[5]),f),u!=null&&(i+=u)}else i+=this.renderTokens(e[4],r,o,a,n);return i}};d.prototype.renderInverted=function(e,r,o,a,n){var s=r.lookup(e[1]);if(!s||T(s)&&s.length===0)return this.renderTokens(e[4],r,o,a,n)};d.prototype.indentPartial=function(e,r,o){for(var a=r.replace(/[^ \t]/g,""),n=e.split(`
`),s=0;s<n.length;s++)n[s].length&&(s>0||!o)&&(n[s]=a+n[s]);return n.join(`
`)};d.prototype.renderPartial=function(e,r,o,a){if(o){var n=this.getConfigTags(a),s=D(o)?o(e[1]):o[e[1]];if(s!=null){var i=e[6],u=e[5],f=e[4],g=s;u==0&&f&&(g=this.indentPartial(s,f,i));var h=this.parse(g,n);return this.renderTokens(h,r,o,g,a)}}};d.prototype.unescapedValue=function(e,r){var o=r.lookup(e[1]);if(o!=null)return o};d.prototype.escapedValue=function(e,r,o){var a=this.getConfigEscape(o)||b.escape,n=r.lookup(e[1]);if(n!=null)return typeof n=="number"&&a===b.escape?String(n):a(n)};d.prototype.rawValue=function(e){return e[1]};d.prototype.getConfigTags=function(e){return T(e)?e:e&&typeof e=="object"?e.tags:void 0};d.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!T(e))return e.escape};var b={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){M.templateCache=t},get templateCache(){return M.templateCache}},M=new d;b.clearCache=function(){return M.clearCache()};b.parse=function(e,r){return M.parse(e,r)};b.render=function(e,r,o,a){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+de(e)+'" was given as the first argument for mustache#render(template, view, partials)');return M.render(e,r,o,a)};b.escape=we;b.Scanner=x;b.Context=C;b.Writer=d;class oe{constructor(e,r){this.template=e,this.state=r,this.ast=b.parse(e)}getValue(){return this.value===void 0&&(this.value=b.render(this.template,this.state)),this.value}onChange(e){const r=[];for(const o of this.getUsedVariables().values())r.push(this.state.onVariableChange(o).subscribe(()=>{const a=b.render(this.template,this.state);a!==this.value&&(this.value=a,e(this.value))}));return{unsubscribe:()=>{for(const o of r)o.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const e=new Set;return this.recursiveGetUsedVariables(this.ast,e),e}recursiveGetUsedVariables(e,r){for(const o of e){const a=o[0],n=o[1],s=o[4];["name","&","#","^"].includes(a)&&r.add(n),s!==void 0&&typeof s!="string"&&this.recursiveGetUsedVariables(s,r)}}}async function xe(){var t;const e=await te();for(const r of e){const o=(t=r.properties)!==null&&t!==void 0?t:[];for(const a of o){if(a.type==="int"||a.type==="bool"||a.type==="object"||typeof a.value!="string")continue;const n=new oe(a.value,WA.state);if(n.isPureString())continue;const s=n.getValue();await Q(r.name,a.name,s),n.onChange(async i=>{await Q(r.name,a.name,i)})}}}async function ke(){var t;const e=await E();for(const[r,o]of e.entries())if(o.type!=="objectgroup"){const a=(t=o.properties)!==null&&t!==void 0?t:[];for(const n of a){if(n.type==="int"||n.type==="bool"||n.type==="object"||typeof n.value!="string")continue;const s=new oe(n.value,WA.state);if(s.isPureString())continue;const i=s.getValue();J(r,n.name,i),s.onChange(u=>{J(r,n.name,u)})}}}async function Q(t,e,r){console.log(t),(await WA.room.area.get(t)).setProperty(e,r)}function J(t,e,r){WA.room.setProperty(t,e,r),e==="visible"&&(r?WA.room.showLayer(t):WA.room.hideLayer(t))}let G,I=0,O=0;function K(t){if(WA.state[t.name]){let e=t.properties.mustGetString("openLayer");for(const r of e.split(`
`))WA.room.showLayer(r);e=t.properties.mustGetString("closeLayer");for(const r of e.split(`
`))WA.room.hideLayer(r)}else{let e=t.properties.mustGetString("openLayer");for(const r of e.split(`
`))WA.room.hideLayer(r);e=t.properties.mustGetString("closeLayer");for(const r of e.split(`
`))WA.room.showLayer(r)}}function Re(t){const e=t.properties.getString("openSound"),r=t.properties.getNumber("soundRadius");let o=1;if(r){const a=ne(t.properties.mustGetString("openLayer").split(`
`));if(a>r)return;o=1-a/r}e&&WA.sound.loadSound(e).play({volume:o})}function Be(t){const e=t.properties.getString("closeSound"),r=t.properties.getNumber("soundRadius");let o=1;if(r){const a=ne(t.properties.mustGetString("closeLayer").split(`
`));if(a>r)return;o=1-a/r}e&&WA.sound.loadSound(e).play({volume:o})}function ae(t){return t.map(e=>G.get(e)).filter(e=>(e==null?void 0:e.type)==="tilelayer")}function ne(t){const e=ae(t),r=re(e),o=((r.right-r.left)/2+r.left)*32,a=((r.bottom-r.top)/2+r.top)*32;return Math.sqrt(Math.pow(I-o,2)+Math.pow(O-a,2))}function Ve(t){WA.state.onVariableChange(t.name).subscribe(()=>{WA.state[t.name]?Re(t):Be(t),K(t)}),K(t)}function H(t,e,r,o){const a=t.name;let n,s,i=!1;const u=r.getString("tag");let f=!0;u&&!WA.player.tags.includes(u)&&(f=!1);const g=!!u;function h(){var p;n&&n.remove(),n=WA.ui.displayActionMessage({message:(p=r.getString("closeTriggerMessage"))!==null&&p!==void 0?p:"Press SPACE to close the door",callback:()=>{WA.state[e.name]=!1,A()}})}function A(){var p;n&&n.remove(),n=WA.ui.displayActionMessage({message:(p=r.getString("openTriggerMessage"))!==null&&p!==void 0?p:"Press SPACE to open the door",callback:()=>{WA.state[e.name]=!0,h()}})}function k(){let p;if(t.type==="tilelayer")p=re(ae(e.properties.mustGetString("closeLayer").split(`
`)));else{if(t.x===void 0||t.y===void 0||t.width===void 0||t.height===void 0)throw new Error(`Doorstep zone "${t.name}" is missing x, y, width or height`);p={top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}s=WA.room.website.create({name:"doorKeypad"+a,url:o+"/keypad.html#"+encodeURIComponent(a),position:{x:p.right*32,y:p.top*32,width:32*3,height:32*4},allowApi:!0})}function S(){s&&(WA.room.website.delete(s.name),s=void 0)}function m(){if(i=!0,r.getBoolean("autoOpen")&&f){WA.state[e.name]=!0;return}if(!WA.state[e.name]&&(g&&!f||!g)&&(r.getString("code")||r.getString("codeVariable"))){k();return}f&&(WA.state[e.name]?h():A())}function W(){i=!1,r.getBoolean("autoClose")&&(WA.state[e.name]=!1),n&&n.remove(),S()}t.type==="tilelayer"?(WA.room.onEnterLayer(a).subscribe(m),WA.room.onLeaveLayer(a).subscribe(W)):(WA.room.area.onEnter(a).subscribe(m),WA.room.area.onLeave(a).subscribe(W)),WA.state.onVariableChange(e.name).subscribe(()=>{i&&(!r.getBoolean("autoClose")&&WA.state[e.name]===!0&&h(),s&&WA.state[e.name]===!0&&S(),!r.getBoolean("autoOpen")&&WA.state[e.name]===!1&&A())})}function ze(t){const e=t.properties.mustGetString("bellSound"),r=t.properties.getNumber("soundRadius");let o=1;if(r){const a=Math.sqrt(Math.pow(t.x-I,2)+Math.pow(t.y-O,2));if(a>r)return;o=1-a/r}WA.sound.loadSound(e).play({volume:o})}function je(t){WA.state[t.name]===void 0&&(WA.state[t.name]=0),WA.state.onVariableChange(t.name).subscribe(()=>{WA.state[t.name]&&ze(t)})}function $(t,e,r){let o;const a=e.getString("bellPopup");if(r.type==="tilelayer"){const n=r.name;WA.room.onEnterLayer(n).subscribe(()=>{var s;a?o=WA.ui.openPopup(a,"",[{label:(s=e.getString("bellButtonText"))!==null&&s!==void 0?s:"Ring",callback:()=>{WA.state[t]=WA.state[t]+1}}]):WA.state[t]=WA.state[t]+1}),WA.room.onLeaveLayer(n).subscribe(()=>{o&&(o.close(),o=void 0)})}else{const n=r.name;WA.room.area.onEnter(n).subscribe(()=>{var s;a?o=WA.ui.openPopup(a,"",[{label:(s=e.getString("bellButtonText"))!==null&&s!==void 0?s:"Ring",callback:()=>{WA.state[t]=WA.state[t]+1}}]):WA.state[t]=WA.state[t]+1}),WA.room.area.onLeave(n).subscribe(()=>{o&&(o.close(),o=void 0)})}}async function qe(t){t=t??N;const e=await ce();G=await E();for(const r of e.values())r.properties.get("door")&&Ve(r),r.properties.get("bell")&&je(r);for(const r of G.values()){const o=new P(r.properties),a=o.getString("doorVariable");if(a&&r.type==="tilelayer"){const s=e.get(a);if(s===void 0)throw new Error('Cannot find variable "'+a+'" referred in the "doorVariable" property of layer "'+r.name+'"');H(r,s,o,t)}const n=o.getString("bellVariable");n&&r.type==="tilelayer"&&$(n,o,r)}for(const r of await te()){const o=new P(r.properties),a=o.getString("doorVariable");if(a){const s=e.get(a);if(s===void 0)throw new Error('Cannot find variable "'+a+'" referred in the "doorVariable" property of object "'+r.name+'"');H(r,s,o,t)}const n=o.getString("bellVariable");n&&$(n,o,r)}WA.player.onPlayerMove(r=>{I=r.x,O=r.y})}function Ge(t,e){const r=t.getString("bindVariable");if(r){const o=t.get("enterValue"),a=t.get("leaveValue"),n=t.getString("triggerMessage"),s=t.getString("tag");Ne(r,e,o,a,n,s)}}function Ne(t,e,r,o,a,n){n&&!WA.player.tags.includes(n)||(r!==void 0&&WA.room.onEnterLayer(e).subscribe(()=>{a||(WA.state[t]=r)}),o!==void 0&&WA.room.onLeaveLayer(e).subscribe(()=>{WA.state[t]=o}))}async function De(){const t=await E();for(const e of t.values()){const r=new P(e.properties);Ge(r,e.name)}}let Y;async function Ie(t){const e=await WA.room.getTiledMap();t=t??N,Y=await E();const r=e.layers.find(o=>o.name==="configuration");if(r){const a=new P(r.properties).getString("tag");(!a||WA.player.tags.includes(a))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(t+"/configuration.html",!0)});for(const n of Y.values()){const s=new P(n.properties),i=s.getString("openConfig");i&&n.type==="tilelayer"&&Oe(i.split(","),n.name,s)}}}function Oe(t,e,r){let o;const a=r.getString("openConfigAdminTag");let n=!0;a&&!WA.player.tags.includes(a)&&(n=!1);function s(){var u;o&&o.remove(),o=WA.ui.displayActionMessage({message:(u=r.getString("openConfigTriggerMessage"))!==null&&u!==void 0?u:"Press SPACE or touch here to configure",callback:()=>U(t)})}function i(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(e).subscribe(()=>{const u=r.getString("openConfigTrigger");n&&(u&&u==="onaction"?s():U(t))}),WA.room.onLeaveLayer(e).subscribe(()=>{o&&o.remove(),i()})}function Ue(){return WA.onInit().then(()=>{qe().catch(t=>console.error(t)),De().catch(t=>console.error(t)),Ie().catch(t=>console.error(t)),ke().catch(t=>console.error(t)),xe().catch(t=>console.error(t))}).catch(t=>console.error(t))}console.info("Join Meeting Script started successfully");let j;WA.onInit().then(()=>{WA.state.hasVariable("askMeeting")||WA.state.saveVariable("askMeeting",{inprogress:!1}),WA.room.area.onEnter("jitsiMeetingZone").subscribe(()=>{_e()}),WA.room.area.onLeave("jitsiMeetingZone").subscribe(()=>{se()}),WA.state.onVariableChange("askMeeting").subscribe(t=>{t.userUuid!==WA.player.uuid&&(t.inprogress?Fe(t):ie())})});const _e=()=>{WA.ui.actionBar.addButton({id:"asktojoinmeeting-btn",label:"Ask Group Meeting",callback:async()=>{let t=await WA.player.getPosition();WA.state.askMeeting={inprogress:!0,userUuid:WA.player.uuid,position:t},se(),j&&clearTimeout(j),j=setTimeout(()=>{WA.state.askMeeting={inprogress:!1}},2e4)}})},se=()=>{WA.ui.actionBar.removeButton("asktojoinmeeting-btn")},Fe=t=>{WA.ui.actionBar.addButton({id:"joinmeeting-btn",label:"Join Group Meeting",callback:()=>{WA.player.moveTo(t.position.x,t.position.y,10),ie()}}),WA.ui.banner.openBanner({id:"banner-joinmeeting",text:"A group meeting is in progress, click on the button 'Join Group Meeting' to walk to the group meeting area.",bgColor:"#000000",textColor:"#ffffff",closable:!0})},ie=()=>{WA.ui.actionBar.removeButton("joinmeeting-btn"),WA.ui.banner.closeBanner("banner-joinmeeting")};console.log("Script started successfully");let l;WA.onInit().then(()=>{console.log("Scripting API ready"),console.log("Player tags: ",WA.player.tags);const t=WA.room.mapURL,r={url:t.substring(0,t.lastIndexOf("/"))+"/information.html",visible:!0,allowApi:!0,allowPolicy:"",position:{vertical:"top",horizontal:"middle"},size:{width:"800px",height:"200px"}},o="Demander un indice vous coûtera 1 minute 💥",a="Vous avez rassemblé tous les indices !",n="Vous devez recommencer. Cela peut être dû à la corruption des données ou vous essayez de tricher 😮";let s=!1;WA.room.onEnterLayer("cigarette").subscribe(()=>{WA.state.CigaretteVisible&&(l=WA.ui.openPopup("cigarettePopup",`Une cigarette laissée par terre. Il y a une poubelle pour ça, mais cette personne était visiblement pressée 😠
 Où ce trouve cette poubelle...`,[{label:"Prendre",className:"primary",callback:()=>{s=!0,WA.state.CigaretteVisible=!1,c()}}]))}),WA.room.onLeaveLayer("cigarette").subscribe(c),WA.room.area.onEnter("garbageCan").subscribe(()=>{s&&!WA.state.CigaretteComplete&&(l=WA.ui.openPopup("garbageCanPopup",`Vous avez jeté la cigarette à la poubelle et validé votre première action écologique 🌍.
 Merci 🫶`,[]),WA.state.CigaretteComplete=!0)}),WA.room.area.onLeave("garbageCan").subscribe(c),WA.room.area.onEnter("info").subscribe(()=>{l=WA.ui.openPopup("infoPopup",`Le but est d'entrer tous ensemble dans le train n°1 et de le démarrer afin de s'échapper !
La porte ne peut être ouverte que si vous avez réussi toutes les énigmes. Bonne chance 💪`,[])}),WA.room.area.onLeave("info").subscribe(c),WA.room.area.onEnter("game").subscribe(()=>{WA.state.TicTacToeComplete?l=WA.ui.openPopup("gamePopup","Pas mal... Je dois avoué que vous êtes plutôt doué 🤔",[]):(l=WA.ui.openPopup("gamePopup","Le morpion... Pensez-vous pourvoir gagner contre nous ? 😈",[]),WA.state.TicTacToeStarted=!0)}),WA.room.area.onLeave("game").subscribe(c),WA.room.onEnterLayer("tic-tac-toe").subscribe(()=>{WA.state.TicTacToeStarted&&WA.room.setProperty("tic-tac-toe","silent",!0)}),WA.room.onLeaveLayer("tic-tac-toe-ongoing-1").subscribe(()=>{WA.room.hideLayer("tic-tac-toe-ongoing-1")}),WA.room.onEnterLayer("tic-tac-toe-ongoing-1").subscribe(()=>{WA.room.showLayer("tic-tac-toe-ongoing-1")}),WA.room.onLeaveLayer("tic-tac-toe-ongoing-2").subscribe(()=>{WA.room.hideLayer("tic-tac-toe-ongoing-2")}),WA.room.onEnterLayer("tic-tac-toe-ongoing-2").subscribe(()=>{WA.room.showLayer("tic-tac-toe-ongoing-2")}),WA.room.onEnterLayer("tic-tac-toe-play1").subscribe(()=>{WA.state.TicTacToeStarted&&(WA.state.TicTacToePlay1=!0,WA.state.TicTacToeComplete=WA.state.TicTacToePlay2)}),WA.room.onLeaveLayer("tic-tac-toe-play1").subscribe(()=>{WA.state.TicTacToeComplete||(WA.state.TicTacToePlay1=!1)}),WA.room.onEnterLayer("tic-tac-toe-play2").subscribe(()=>{WA.state.TicTacToeStarted&&(WA.state.TicTacToePlay2=!0,WA.state.TicTacToeComplete=WA.state.TicTacToePlay1)}),WA.room.onLeaveLayer("tic-tac-toe-play2").subscribe(()=>{WA.state.TicTacToeComplete||(WA.state.TicTacToePlay2=!1)}),WA.chat.onChatMessage(i=>{WA.state.QuestionOngoing&&(WA.state.QuestionComplete=i=="46",WA.state.QuestionComplete?(WA.chat.sendChatMessage("Parfait! Vous pouvez entrer 🚀","KindRobot000"),WA.state.TrainDoorOpen=!0,WA.state.GameState="room2"):(WA.chat.sendChatMessage(`Aïe, détective n'est pas votre qualité première... je me trompe ?
Malheureusement, vous devez tout reprendre depuis le début 😪`,"KindRobot000"),WA.state.TicTacToeStarted=!1,WA.state.TicTacToePlay1=!1,WA.state.TicTacToePlay2=!1,WA.state.TicTacToeComplete=!1,WA.state.CigaretteVisible=!0,s=!1,WA.state.CigaretteComplete=!1,WA.state.QuestionOngoing=!1,WA.state.QuestionComplete=!1,WA.state.TrainDoorOpen=!1))}),WA.room.area.onEnter("room1bot").subscribe(()=>{if(!WA.state.QuestionComplete)if(WA.state.TicTacToeComplete&&WA.state.CigaretteComplete)WA.chat.sendChatMessage("Mr Robot : Tapez votre réponse ici, mais réfléchissez bien ! Si vous faites une erreur, vous devrez tout recommencer.","KindRobot000"),WA.state.QuestionOngoing=!0;else{const i=WA.state.loadVariable("Room1Clue3")===!0;l=WA.ui.openPopup("room1botPopup","Mr Robot : Étranger, je bloquerai l'accès à ce train jusqu'à ce que vous prouviez votre valeur. "+(i?a:o),i?[]:[{label:"Give me a clue",className:"primary",callback:()=>{q(1),l.close();const u={label:"Close",className:"primary",callback:()=>c()};WA.state.loadVariable("Room1Clue3")===!0?l=WA.ui.openPopup("room1botPopup",a,[u]):l=WA.ui.openPopup("room1botPopup","Mr Robot : Étranger, reviens vers moi si tu veux un autre indice !",[u])}}])}}),WA.room.area.onLeave("room1bot").subscribe(c),WA.room.area.onEnter("goToDriverCabine").subscribe(()=>{WA.nav.goToRoom("#driver-cabine");const i=137*32,u=16*32;WA.camera.set(i,u,500,500,!1,!0)}),WA.room.onEnterLayer("driver-cabine").subscribe(()=>{WA.state.TrainDoorOpen||(WA.controls.disablePlayerControls(),l=WA.ui.openPopup("driverCabinePopup",n,[{label:"Teleport",className:"primary",callback:()=>{c(),WA.nav.goToRoom("#start")}}]))}),WA.room.area.onEnter("room2bot").subscribe(()=>{WA.state.TrainStarted||(l=WA.ui.openPopup("room2botPopup","Étranger, il semble que ce train ne démarrera pas tant que vous n'aurez pas trouvé la bonne clé. "+o,[{label:"Give me a clue",className:"primary",callback:()=>q(2)}]))}),WA.room.area.onLeave("room2bot").subscribe(c),WA.room.area.onEnter("room2coffee").subscribe(()=>{l=WA.ui.openPopup("room2coffeePopup","Yous avez trouvé une tasse de café. Des études ont montré que la consommation optimale pour des adultes en bonne santé est de 3 tasses de café.",[])}),WA.room.area.onLeave("room2coffee").subscribe(c),WA.room.area.onEnter("room2pretzel").subscribe(()=>{l=WA.ui.openPopup("room2pretzelPopup","Vous avez trouvé un bretzel. Vu la taille de ce Bretzel, 1 suffit amplement au petit-déjeuner !",[])}),WA.room.area.onLeave("room2pretzel").subscribe(c),WA.room.area.onEnter("room2oldMap").subscribe(()=>{l=WA.ui.openPopup("room2oldMapPopup","Vous avez trouvé une vieille carte. C'est très rare. Il n'en existe que 8 comme celui-ci dans le monde !",[])}),WA.room.area.onLeave("room2oldMap").subscribe(c),WA.room.area.onEnter("room2coins").subscribe(()=>{l=WA.ui.openPopup("room2coinsPopup","Vous avez trouvé des pièces. 5 de plus et vous pourrez peut-être les échanger contre un billet de banque.",[])}),WA.room.area.onLeave("room2coins").subscribe(c),WA.room.onEnterLayer("teleportRoom3").subscribe(()=>{WA.state.TrainStarted&&(l=WA.ui.openPopup("teleportRoom3Popup","Maintenant que le train peut démarrer, vous pouvez passer à la salle suivante !",[{label:"Teleport",className:"primary",callback:()=>{WA.nav.goToRoom("#max-maulwurf");const i=241*32,u=27*32;WA.camera.set(i,u,500,500,!1,!0),WA.state.GameState="room3"}}]))}),WA.room.onLeaveLayer("teleportRoom3").subscribe(c),WA.room.onEnterLayer("max-maulwurf").subscribe(()=>{WA.state.TrainStarted||(WA.controls.disablePlayerControls(),l=WA.ui.openPopup("room3Popup",n,[{label:"Teleport",className:"primary",callback:()=>{c(),WA.nav.goToRoom("#start")}}]))}),WA.room.onLeaveLayer("max-maulwurf").subscribe(c),WA.room.area.onEnter("trainRoom3").subscribe(()=>{l=WA.ui.openPopup("room3Popup","Oups, on dirait que le train a été arrêté immédiatement ! Enquêtez sur la zone pour découvrir ce qui s'est passé 💥",[])}),WA.room.area.onLeave("trainRoom3").subscribe(c),WA.room.area.onEnter("room3bot").subscribe(()=>{WA.state.isMaxHappy||(l=WA.ui.openPopup("room3botPopup",`Étranger, il semble que votre bien-aimé Max Maulwurf ait faim. Vous serez bloqué ici jusqu'à ce que vous le réconfortiez.
`+o,[{label:"Give me a clue",className:"primary",callback:()=>q(3)}]))}),WA.room.area.onLeave("room3bot").subscribe(c),WA.room.area.onEnter("room3helmet").subscribe(()=>{WA.state.helmetFound||(l=WA.ui.openPopup("room3helmetPopup","Vous avez trouvé le casque de travail jaune ! Cela devrait aider à calmer Max Maulwurf 🪖",[{label:"Prendre",className:"primary",callback:()=>{WA.state.helmetFound=!0,c()}}]))}),WA.room.area.onLeave("room3helmet").subscribe(c),WA.room.area.onEnter("room3DBtrophy").subscribe(()=>{WA.state.DBtrophyFound||(l=WA.ui.openPopup("room3DBtrophyPopup","Génial, vous avez trouvé le trophé Nexton ! Cela devrait calmer Max You Maulwurf 🏆",[{label:"Prendre",className:"primary",callback:()=>{WA.state.DBtrophyFound=!0,c()}}]))}),WA.room.area.onLeave("room3DBtrophy").subscribe(c),WA.room.area.onEnter("room3WAmug").subscribe(()=>{WA.state.WAmugFound||(l=WA.ui.openPopup("room3WAmugPopup","Vous avez trouvé la tasse à café WorkAdventure ! Cela devrait aider à calmer Max Maulwurf ☕",[{label:"Prendre",className:"primary",callback:()=>{WA.state.WAmugFound=!0,c()}}]))}),WA.room.area.onLeave("room3WAmug").subscribe(c),WA.room.area.onEnter("maxMaulwurf").subscribe(()=>{WA.state.powerRestarted?l=WA.ui.openPopup("maxMaulwurfPopup","Un grand mercie d'avoir réparé la gare 😍",[]):WA.state.WAmugFound&&WA.state.helmetFound&&WA.state.DBtrophyFound?(WA.room.hideLayer("maxHungry"),WA.room.showLayer("maxHappy"),l=WA.ui.openPopup("maxMaulwurfPopup",`Vous avez donné les 3 objets à Max. Après avoir reçu tous les objets, il se calme et fait une pause en regardant son casque bien-aimé. Il se souvient de son passage à la Nexton : sa tâche principale était d'informer sur la construction et les réparations... Il s'excuse et accepte d'allumer l'alimentation électrique.
\rDépêchez-vous et redémarrez le système de contrôle de la circulation des trains au terminal pour éviter de nouveaux retards !`,[]),WA.state.isMaxHappy=!0):l=WA.ui.openPopup("maxMaulwurfPopup","Max a l'air affamé... on dirait que c'est lui qui a causé les dégâts dans la centrale électrique parce qu'il est triste de ne plus être la mascotte des chemins de fer.",[])}),WA.room.area.onLeave("maxMaulwurf").subscribe(c),WA.room.area.onEnter("terminal").subscribe(()=>{WA.state.isMaxHappy?WA.state.powerRestarted?WA.nav.openCoWebSite(WA.state.formURL):l=WA.ui.openPopup("terminalPopup","Il semble que vous deviez redémarrer le système pour terminer votre mission ! 💻",[{label:"RESTART",className:"primary",callback:()=>Je()}]):l=WA.ui.openPopup("terminalPopup","C'est le terminal... mais il est hors service ⛔",[])}),WA.room.area.onLeave("terminal").subscribe(()=>{Qe()}),WA.room.area.onEnter("startZone").subscribe(()=>{X()}),WA.room.area.onLeave("startZone").subscribe(()=>{c()}),Ue().then(()=>{console.log("Scripting API Extra ready");const i=WA.state.onVariableChange("GameStarted").subscribe(u=>{u===!0&&(WA.ui.website.open(r),i.unsubscribe(),c(),WA.controls.restorePlayerControls())});WA.state.onVariableChange("TicTacToeComplete").subscribe(u=>{u===!0&&(c(),l=WA.ui.openPopup("gamePopup","Pas mal... Je dois avoué que vous êtes plutôt doué 🤔",[]),WA.state.QuestionReady=WA.state.CigaretteComplete)}),WA.state.onVariableChange("CigaretteComplete").subscribe(u=>{u===!0&&(WA.state.QuestionReady=WA.state.TicTacToeComplete)}),WA.state.GameStarted===!1?(X(),WA.controls.disablePlayerControls()):WA.ui.website.open(r)}).catch(i=>console.error(i))}).catch(t=>console.error(t));function X(){c(),l=WA.ui.openPopup("startPopup",`Vous venez d'atterrir dans une gare abandonnée. En cliquant sur le bouton 'C'est parti !', le chronomètre de 20 minutes démarre.
Votre mission, trouver et résoudre toutes les énigmes présentes danc cette gare. Bon chance... 🚀`,[{label:"C'est parti !",className:"error",callback:()=>{WA.state.GameStarted=!0,c(),WA.controls.restorePlayerControls()}}])}function c(){console.trace("currentPopup",l),l!=null&&(l.close(),l=void 0)}async function Qe(){c(),(await WA.nav.getCoWebSites()).length&&WA.nav.closeCoWebSite()}function q(t){let e="";for(let r=1;r<4;r++)if(e=`Room${t}Clue${r}`,WA.state.loadVariable(e)===!1){WA.state.saveVariable(e,!0);return}}function Je(){c(),WA.state.powerRestarted=!0,WA.nav.openCoWebSite(WA.state.formURL),l=WA.ui.openPopup("terminalPopup","Un grand mercie d'avoir réparé la gare 😍",[{label:"Fermer",className:"primary",callback:()=>c()}])}
