class L{constructor(e){this.properties=e??[]}get(e){const t=this.properties.filter(o=>o.name===e).map(o=>o.value);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}getString(e){return this.getByType(e,"string")}getNumber(e){return this.getByType(e,"number")}getBoolean(e){return this.getByType(e,"boolean")}getByType(e,t){const o=this.get(e);if(o!==void 0){if(t!=="json"&&typeof o!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return o}}mustGetString(e){return this.mustGetByType(e,"string")}mustGetNumber(e){return this.mustGetByType(e,"number")}mustGetBoolean(e){return this.mustGetByType(e,"boolean")}mustGetByType(e,t){const o=this.get(e);if(o===void 0)throw new Error('Property "'+e+'" is missing');if(t!=="json"&&typeof o!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return o}getType(e){const t=this.properties.filter(o=>o.name===e).map(o=>o.type);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}}const I="https://unpkg.com/@workadventure/scripting-api-extra@1.4.6/dist";class se{constructor(e){this.name=e.name,this.x=e.x,this.y=e.y,this.properties=new L(e.properties)}get isReadable(){const e=this.properties.getString("readableBy");return e?WA.player.tags.includes(e):!0}get isWritable(){const e=this.properties.getString("writableBy");return e?WA.player.tags.includes(e):!0}}function N(r){const e=r?"#"+r.join():"";WA.nav.openCoWebSite(I+"/configuration.html"+e)}async function ie(r,e){const t=await WA.room.getTiledMap(),o=new Map;return $(t.layers,o,r,e),o}function $(r,e,t,o){for(const n of r)if(n.type==="objectgroup"){for(const a of n.objects)if(a.type==="variable"||a.class==="variable"){if(t&&n.name!==t||o&&!o.includes(a.name))continue;e.set(a.name,new se(a))}}else n.type==="group"&&$(n.layers,e,t,o)}let V;async function E(){return V===void 0&&(V=ue()),V}async function ue(){return le(await WA.room.getTiledMap())}function le(r){const e=new Map;return Y(r.layers,"",e),e}function Y(r,e,t){for(const o of r)o.type==="group"?Y(o.layers,e+o.name+"/",t):(o.name=e+o.name,t.set(o.name,o))}async function ce(){const r=await E(),e=[];for(const t of r.values())if(t.type==="objectgroup")for(const o of t.objects)(o.type==="area"||o.class==="area")&&e.push(o);return e}function pe(r){let e=1/0,t=1/0,o=0,n=0;const a=r.data;if(typeof a=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let s=0;s<r.height;s++)for(let i=0;i<r.width;i++)a[i+s*r.width]!==0&&(e=Math.min(e,i),n=Math.max(n,i),t=Math.min(t,s),o=Math.max(o,s));return{top:t,left:e,right:n+1,bottom:o+1}}function X(r){let e=1/0,t=1/0,o=0,n=0;for(const a of r){const s=pe(a);s.left<e&&(e=s.left),s.top<t&&(t=s.top),s.right>n&&(n=s.right),s.bottom>o&&(o=s.bottom)}return{top:t,left:e,right:n,bottom:o}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var fe=Object.prototype.toString,C=Array.isArray||function(e){return fe.call(e)==="[object Array]"};function O(r){return typeof r=="function"}function me(r){return C(r)?"array":typeof r}function z(r){return r.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function _(r,e){return r!=null&&typeof r=="object"&&e in r}function de(r,e){return r!=null&&typeof r!="object"&&r.hasOwnProperty&&r.hasOwnProperty(e)}var ge=RegExp.prototype.test;function be(r,e){return ge.call(r,e)}var he=/\S/;function ye(r){return!be(he,r)}var Ae={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function We(r){return String(r).replace(/[&<>"'`=\/]/g,function(t){return Ae[t]})}var ve=/\s*/,we=/\s+/,Q=/\s*=/,Te=/\s*\}/,Ce=/#|\^|\/|>|\{|&|=|!/;function Pe(r,e){if(!r)return[];var t=!1,o=[],n=[],a=[],s=!1,i=!1,u="",p=0;function m(){if(s&&!i)for(;a.length;)delete n[a.pop()];else a=[];s=!1,i=!1}var h,A,R;function P(v){if(typeof v=="string"&&(v=v.split(we,2)),!C(v)||v.length!==2)throw new Error("Invalid tags: "+v);h=new RegExp(z(v[0])+"\\s*"),A=new RegExp("\\s*"+z(v[1])),R=new RegExp("\\s*"+z("}"+v[1]))}P(e||b.tags);for(var c=new x(r),W,g,y,S,B,w;!c.eos();){if(W=c.pos,y=c.scanUntil(h),y)for(var k=0,ae=y.length;k<ae;++k)S=y.charAt(k),ye(S)?(a.push(n.length),u+=S):(i=!0,t=!0,u+=" "),n.push(["text",S,W,W+1]),W+=1,S===`
`&&(m(),u="",p=0,t=!1);if(!c.scan(h))break;if(s=!0,g=c.scan(Ce)||"name",c.scan(ve),g==="="?(y=c.scanUntil(Q),c.scan(Q),c.scanUntil(A)):g==="{"?(y=c.scanUntil(R),c.scan(Te),c.scanUntil(A),g="&"):y=c.scanUntil(A),!c.scan(A))throw new Error("Unclosed tag at "+c.pos);if(g==">"?B=[g,y,W,c.pos,u,p,t]:B=[g,y,W,c.pos],p++,n.push(B),g==="#"||g==="^")o.push(B);else if(g==="/"){if(w=o.pop(),!w)throw new Error('Unopened section "'+y+'" at '+W);if(w[1]!==y)throw new Error('Unclosed section "'+w[1]+'" at '+W)}else g==="name"||g==="{"||g==="&"?i=!0:g==="="&&P(y)}if(m(),w=o.pop(),w)throw new Error('Unclosed section "'+w[1]+'" at '+c.pos);return Le(Se(n))}function Se(r){for(var e=[],t,o,n=0,a=r.length;n<a;++n)t=r[n],t&&(t[0]==="text"&&o&&o[0]==="text"?(o[1]+=t[1],o[3]=t[3]):(e.push(t),o=t));return e}function Le(r){for(var e=[],t=e,o=[],n,a,s=0,i=r.length;s<i;++s)switch(n=r[s],n[0]){case"#":case"^":t.push(n),o.push(n),t=n[4]=[];break;case"/":a=o.pop(),a[5]=n[2],t=o.length>0?o[o.length-1][4]:e;break;default:t.push(n)}return e}function x(r){this.string=r,this.tail=r,this.pos=0}x.prototype.eos=function(){return this.tail===""};x.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var o=t[0];return this.tail=this.tail.substring(o.length),this.pos+=o.length,o};x.prototype.scanUntil=function(e){var t=this.tail.search(e),o;switch(t){case-1:o=this.tail,this.tail="";break;case 0:o="";break;default:o=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=o.length,o};function T(r,e){this.view=r,this.cache={".":this.view},this.parent=e}T.prototype.push=function(e){return new T(e,this)};T.prototype.lookup=function(e){var t=this.cache,o;if(t.hasOwnProperty(e))o=t[e];else{for(var n=this,a,s,i,u=!1;n;){if(e.indexOf(".")>0)for(a=n.view,s=e.split("."),i=0;a!=null&&i<s.length;)i===s.length-1&&(u=_(a,s[i])||de(a,s[i])),a=a[s[i++]];else a=n.view[e],u=_(n.view,e);if(u){o=a;break}n=n.parent}t[e]=o}return O(o)&&(o=o.call(this.view)),o};function d(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}d.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};d.prototype.parse=function(e,t){var o=this.templateCache,n=e+":"+(t||b.tags).join(":"),a=typeof o<"u",s=a?o.get(n):void 0;return s==null&&(s=Pe(e,t),a&&o.set(n,s)),s};d.prototype.render=function(e,t,o,n){var a=this.getConfigTags(n),s=this.parse(e,a),i=t instanceof T?t:new T(t,void 0);return this.renderTokens(s,i,o,e,n)};d.prototype.renderTokens=function(e,t,o,n,a){for(var s="",i,u,p,m=0,h=e.length;m<h;++m)p=void 0,i=e[m],u=i[0],u==="#"?p=this.renderSection(i,t,o,n,a):u==="^"?p=this.renderInverted(i,t,o,n,a):u===">"?p=this.renderPartial(i,t,o,a):u==="&"?p=this.unescapedValue(i,t):u==="name"?p=this.escapedValue(i,t,a):u==="text"&&(p=this.rawValue(i)),p!==void 0&&(s+=p);return s};d.prototype.renderSection=function(e,t,o,n,a){var s=this,i="",u=t.lookup(e[1]);function p(A){return s.render(A,t,o,a)}if(u){if(C(u))for(var m=0,h=u.length;m<h;++m)i+=this.renderTokens(e[4],t.push(u[m]),o,n,a);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")i+=this.renderTokens(e[4],t.push(u),o,n,a);else if(O(u)){if(typeof n!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,n.slice(e[3],e[5]),p),u!=null&&(i+=u)}else i+=this.renderTokens(e[4],t,o,n,a);return i}};d.prototype.renderInverted=function(e,t,o,n,a){var s=t.lookup(e[1]);if(!s||C(s)&&s.length===0)return this.renderTokens(e[4],t,o,n,a)};d.prototype.indentPartial=function(e,t,o){for(var n=t.replace(/[^ \t]/g,""),a=e.split(`
`),s=0;s<a.length;s++)a[s].length&&(s>0||!o)&&(a[s]=n+a[s]);return a.join(`
`)};d.prototype.renderPartial=function(e,t,o,n){if(o){var a=this.getConfigTags(n),s=O(o)?o(e[1]):o[e[1]];if(s!=null){var i=e[6],u=e[5],p=e[4],m=s;u==0&&p&&(m=this.indentPartial(s,p,i));var h=this.parse(m,a);return this.renderTokens(h,t,o,m,n)}}};d.prototype.unescapedValue=function(e,t){var o=t.lookup(e[1]);if(o!=null)return o};d.prototype.escapedValue=function(e,t,o){var n=this.getConfigEscape(o)||b.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&n===b.escape?String(a):n(a)};d.prototype.rawValue=function(e){return e[1]};d.prototype.getConfigTags=function(e){return C(e)?e:e&&typeof e=="object"?e.tags:void 0};d.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!C(e))return e.escape};var b={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(r){M.templateCache=r},get templateCache(){return M.templateCache}},M=new d;b.clearCache=function(){return M.clearCache()};b.parse=function(e,t){return M.parse(e,t)};b.render=function(e,t,o,n){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+me(e)+'" was given as the first argument for mustache#render(template, view, partials)');return M.render(e,t,o,n)};b.escape=We;b.Scanner=x;b.Context=T;b.Writer=d;class ee{constructor(e,t){this.template=e,this.state=t,this.ast=b.parse(e)}getValue(){return this.value===void 0&&(this.value=b.render(this.template,this.state)),this.value}onChange(e){const t=[];for(const o of this.getUsedVariables().values())t.push(this.state.onVariableChange(o).subscribe(()=>{const n=b.render(this.template,this.state);n!==this.value&&(this.value=n,e(this.value))}));return{unsubscribe:()=>{for(const o of t)o.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const e=new Set;return this.recursiveGetUsedVariables(this.ast,e),e}recursiveGetUsedVariables(e,t){for(const o of e){const n=o[0],a=o[1],s=o[4];["name","&","#","^"].includes(n)&&t.add(a),s!==void 0&&typeof s!="string"&&this.recursiveGetUsedVariables(s,t)}}}async function Me(){var r;const e=await ce();for(const t of e){const o=(r=t.properties)!==null&&r!==void 0?r:[];for(const n of o){if(n.type==="int"||n.type==="bool"||n.type==="object"||typeof n.value!="string")continue;const a=new ee(n.value,WA.state);if(a.isPureString())continue;const s=a.getValue();await K(t.name,n.name,s),a.onChange(async i=>{await K(t.name,n.name,i)})}}}async function Ee(){var r;const e=await E();for(const[t,o]of e.entries())if(o.type!=="objectgroup"){const n=(r=o.properties)!==null&&r!==void 0?r:[];for(const a of n){if(a.type==="int"||a.type==="bool"||a.type==="object"||typeof a.value!="string")continue;const s=new ee(a.value,WA.state);if(s.isPureString())continue;const i=s.getValue();H(t,a.name,i),s.onChange(u=>{H(t,a.name,u)})}}}async function K(r,e,t){console.log(r),(await WA.room.area.get(r)).setProperty(e,t)}function H(r,e,t){WA.room.setProperty(r,e,t),e==="visible"&&(t?WA.room.showLayer(r):WA.room.hideLayer(r))}let q,D=0,U=0;function J(r){if(WA.state[r.name]){let e=r.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.showLayer(t);e=r.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.hideLayer(t)}else{let e=r.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.hideLayer(t);e=r.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.showLayer(t)}}function xe(r){const e=r.properties.getString("openSound"),t=r.properties.getNumber("soundRadius");let o=1;if(t){const n=re(r.properties.mustGetString("openLayer").split(`
`));if(n>t)return;o=1-n/t}e&&WA.sound.loadSound(e).play({volume:o})}function Re(r){const e=r.properties.getString("closeSound"),t=r.properties.getNumber("soundRadius");let o=1;if(t){const n=re(r.properties.mustGetString("closeLayer").split(`
`));if(n>t)return;o=1-n/t}e&&WA.sound.loadSound(e).play({volume:o})}function te(r){return r.map(e=>q.get(e)).filter(e=>(e==null?void 0:e.type)==="tilelayer")}function re(r){const e=te(r),t=X(e),o=((t.right-t.left)/2+t.left)*32,n=((t.bottom-t.top)/2+t.top)*32;return Math.sqrt(Math.pow(D-o,2)+Math.pow(U-n,2))}function Be(r){WA.state.onVariableChange(r.name).subscribe(()=>{WA.state[r.name]?xe(r):Re(r),J(r)}),J(r)}function ke(r,e,t,o){const n=r.name;let a,s,i=!1;const u=t.getString("tag");let p=!0;u&&!WA.player.tags.includes(u)&&(p=!1);const m=!!u;function h(){var c;a&&a.remove(),a=WA.ui.displayActionMessage({message:(c=t.getString("closeTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE to close the door",callback:()=>{WA.state[e.name]=!1,A()}})}function A(){var c;a&&a.remove(),a=WA.ui.displayActionMessage({message:(c=t.getString("openTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE to open the door",callback:()=>{WA.state[e.name]=!0,h()}})}function R(c){const W=X(te(e.properties.mustGetString("closeLayer").split(`
`)));s=WA.room.website.create({name:"doorKeypad"+c,url:o+"/keypad.html#"+encodeURIComponent(c),position:{x:W.right*32,y:W.top*32,width:32*3,height:32*4},allowApi:!0})}function P(){s&&(WA.room.website.delete(s.name),s=void 0)}WA.room.onEnterLayer(n).subscribe(()=>{if(i=!0,t.getBoolean("autoOpen")&&p){WA.state[e.name]=!0;return}if(!WA.state[e.name]&&(m&&!p||!m)&&(t.getString("code")||t.getString("codeVariable"))){R(n);return}p&&(WA.state[e.name]?h():A())}),WA.room.onLeaveLayer(n).subscribe(()=>{i=!1,t.getBoolean("autoClose")&&(WA.state[e.name]=!1),a&&a.remove(),P()}),WA.state.onVariableChange(e.name).subscribe(()=>{i&&(!t.getBoolean("autoClose")&&WA.state[e.name]===!0&&h(),s&&WA.state[e.name]===!0&&P(),!t.getBoolean("autoOpen")&&WA.state[e.name]===!1&&A())})}function Ve(r){const e=r.properties.mustGetString("bellSound"),t=r.properties.getNumber("soundRadius");let o=1;if(t){const n=Math.sqrt(Math.pow(r.x-D,2)+Math.pow(r.y-U,2));if(n>t)return;o=1-n/t}WA.sound.loadSound(e).play({volume:o})}function ze(r){WA.state[r.name]===void 0&&(WA.state[r.name]=0),WA.state.onVariableChange(r.name).subscribe(()=>{WA.state[r.name]&&Ve(r)})}function je(r,e,t){let o;const n=e.getString("bellPopup");WA.room.onEnterLayer(t).subscribe(()=>{var a;n?o=WA.ui.openPopup(n,"",[{label:(a=e.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[r]=WA.state[r]+1}}]):WA.state[r]=WA.state[r]+1}),WA.room.onLeaveLayer(t).subscribe(()=>{o&&(o.close(),o=void 0)})}async function Ge(r){r=r??I;const e=await ie();q=await E();for(const t of e.values())t.properties.get("door")&&Be(t),t.properties.get("bell")&&ze(t);for(const t of q.values()){const o=new L(t.properties),n=o.getString("doorVariable");if(n&&t.type==="tilelayer"){const s=e.get(n);if(s===void 0)throw new Error('Cannot find variable "'+n+'" referred in the "doorVariable" property of layer "'+t.name+'"');ke(t,s,o,r)}const a=o.getString("bellVariable");a&&je(a,o,t.name)}WA.player.onPlayerMove(t=>{D=t.x,U=t.y})}function qe(r,e){const t=r.getString("bindVariable");if(t){const o=r.get("enterValue"),n=r.get("leaveValue"),a=r.getString("triggerMessage"),s=r.getString("tag");Ie(t,e,o,n,a,s)}}function Ie(r,e,t,o,n,a){a&&!WA.player.tags.includes(a)||(t!==void 0&&WA.room.onEnterLayer(e).subscribe(()=>{n||(WA.state[r]=t)}),o!==void 0&&WA.room.onLeaveLayer(e).subscribe(()=>{WA.state[r]=o}))}async function Oe(){const r=await E();for(const e of r.values()){const t=new L(e.properties);qe(t,e.name)}}let F;async function De(r){const e=await WA.room.getTiledMap();r=r??I,F=await E();const t=e.layers.find(o=>o.name==="configuration");if(t){const n=new L(t.properties).getString("tag");(!n||WA.player.tags.includes(n))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(r+"/configuration.html",!0)});for(const a of F.values()){const s=new L(a.properties),i=s.getString("openConfig");i&&a.type==="tilelayer"&&Ue(i.split(","),a.name,s)}}}function Ue(r,e,t){let o;const n=t.getString("openConfigAdminTag");let a=!0;n&&!WA.player.tags.includes(n)&&(a=!1);function s(){var u;o&&o.remove(),o=WA.ui.displayActionMessage({message:(u=t.getString("openConfigTriggerMessage"))!==null&&u!==void 0?u:"Press SPACE or touch here to configure",callback:()=>N(r)})}function i(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(e).subscribe(()=>{const u=t.getString("openConfigTrigger");a&&(u&&u==="onaction"?s():N(r))}),WA.room.onLeaveLayer(e).subscribe(()=>{o&&o.remove(),i()})}function Ne(){return WA.onInit().then(()=>{Ge().catch(r=>console.error(r)),Oe().catch(r=>console.error(r)),De().catch(r=>console.error(r)),Ee().catch(r=>console.error(r)),Me().catch(r=>console.error(r))}).catch(r=>console.error(r))}console.info("Join Meeting Script started successfully");let j;WA.onInit().then(()=>{WA.state.hasVariable("askMeeting")||WA.state.saveVariable("askMeeting",{inprogress:!1}),WA.room.area.onEnter("jitsiMeetingZone").subscribe(()=>{_e()}),WA.room.area.onLeave("jitsiMeetingZone").subscribe(()=>{oe()}),WA.state.onVariableChange("askMeeting").subscribe(r=>{r.userUuid!==WA.player.uuid&&(r.inprogress?Qe(r):ne())})});const _e=()=>{WA.ui.actionBar.addButton({id:"asktojoinmeeting-btn",label:"Ask Group Meeting",callback:async()=>{let r=await WA.player.getPosition();WA.state.askMeeting={inprogress:!0,userUuid:WA.player.uuid,position:r},oe(),j&&clearTimeout(j),j=setTimeout(()=>{WA.state.askMeeting={inprogress:!1}},2e4)}})},oe=()=>{WA.ui.actionBar.removeButton("asktojoinmeeting-btn")},Qe=r=>{WA.ui.actionBar.addButton({id:"joinmeeting-btn",label:"Join Group Meeting",callback:()=>{WA.player.moveTo(r.position.x,r.position.y,10),ne()}}),WA.ui.banner.openBanner({id:"banner-joinmeeting",text:"A group meeting is in progress, click on the button 'Join Group Meeting' to walk to the group meeting area.",bgColor:"#000000",textColor:"#ffffff",closable:!0})},ne=()=>{WA.ui.actionBar.removeButton("joinmeeting-btn"),WA.ui.banner.closeBanner("banner-joinmeeting")};console.log("Script started successfully");let l;WA.onInit().then(()=>{console.log("Scripting API ready"),console.log("Player tags: ",WA.player.tags);const r=WA.room.mapURL,t={url:r.substring(0,r.lastIndexOf("/"))+"/information.html",visible:!0,allowApi:!0,allowPolicy:"",position:{vertical:"top",horizontal:"middle"},size:{width:"800px",height:"200px"}},o="Demander un indice vous coûtera 1 minute 💥",n="Vous avez rassemblé tous les indices !",a="Vous devez recommencer. Cela peut être dû à la corruption des données ou vous essayez de tricher 😮";let s=!1;WA.room.onEnterLayer("cigarette").subscribe(()=>{WA.state.CigaretteVisible&&(l=WA.ui.openPopup("cigarettePopup","Une cigarette laissée par terre. Il y a une poubelle pour ça, mais cette personne était visiblement pressée 😠",[]),s=!0,WA.state.CigaretteVisible=!1)}),WA.room.onLeaveLayer("cigarette").subscribe(f),WA.room.area.onEnter("garbageCan").subscribe(()=>{s&&!WA.state.CigaretteComplete&&(l=WA.ui.openPopup("garbageCanPopup","Vous pouvez jetez la cigarette à la poubelle pour valider votre première action écologique 🌍. Merci 🫶",[]),WA.state.CigaretteComplete=!0)}),WA.room.area.onLeave("garbageCan").subscribe(f),WA.room.area.onEnter("info").subscribe(()=>{l=WA.ui.openPopup("infoPopup","Le but est d'entrer tous ensemble dans le train n°1 et de le démarrer afin de s'échapper ! La porte ne peut être ouverte que si vous avez réussi toutes les énigmes. Bonne chance 💪",[])}),WA.room.area.onLeave("info").subscribe(f),WA.room.area.onEnter("game").subscribe(()=>{l=WA.ui.openPopup("gamePopup","Le morpion... Pensez-vous pourvoir gagner contre nous ? 😈",[]),WA.state.TicTacToeStarted=!0}),WA.room.area.onLeave("game").subscribe(f),WA.room.onEnterLayer("tic-tac-toe").subscribe(()=>{WA.state.TicTacToeStarted&&(WA.state.TicTacToeOngoing=!0,WA.room.setProperty("tic-tac-toe","silent",!0))}),WA.room.onLeaveLayer("tic-tac-toe").subscribe(()=>{WA.state.TicTacToeComplete||(WA.state.TicTacToeOngoing=!1)}),WA.room.onEnterLayer("tic-tac-toe-play1").subscribe(()=>{WA.state.TicTacToeStarted&&(WA.state.TicTacToePlay1=!0,WA.state.TicTacToeComplete=WA.state.TicTacToePlay2)}),WA.room.onLeaveLayer("tic-tac-toe-play1").subscribe(()=>{WA.state.TicTacToeComplete||(WA.state.TicTacToePlay1=!1)}),WA.room.onEnterLayer("tic-tac-toe-play2").subscribe(()=>{WA.state.TicTacToeStarted&&(WA.state.TicTacToePlay2=!0,WA.state.TicTacToeComplete=WA.state.TicTacToePlay1)}),WA.room.onLeaveLayer("tic-tac-toe-play2").subscribe(()=>{WA.state.TicTacToeComplete||(WA.state.TicTacToePlay2=!1)}),WA.chat.onChatMessage(i=>{WA.state.QuestionOngoing&&(WA.state.QuestionComplete=i=="46",WA.state.QuestionComplete?(WA.chat.sendChatMessage("Parfait! Vous pouvez entrer 🚀","KindRobot000"),WA.state.TrainDoorOpen=!0,WA.state.GameState="room2"):(WA.chat.sendChatMessage("Aïe, détective n'est pas votre qualité première... je me trompe ? Malheureusement, vous devez tout reprendre depuis le début 😪","KindRobot000"),WA.state.TicTacToeStarted=!1,WA.state.TicTacToeOngoing=!1,WA.state.TicTacToePlay1=!1,WA.state.TicTacToePlay2=!1,WA.state.TicTacToeComplete=!1,WA.state.CigaretteVisible=!0,s=!1,WA.state.CigaretteComplete=!1,WA.state.QuestionOngoing=!1,WA.state.QuestionComplete=!1,WA.state.TrainDoorOpen=!1))}),WA.room.area.onEnter("room1bot").subscribe(()=>{if(!WA.state.QuestionComplete)if(WA.state.TicTacToeComplete&&WA.state.CigaretteComplete)WA.chat.sendChatMessage("Mr Robot : Tapez votre réponse ici, mais réfléchissez bien ! Si vous faites une erreur, vous devrez tout recommencer.","KindRobot000"),WA.state.QuestionOngoing=!0;else{const i=WA.state.loadVariable("Room1Clue3")===!0;l=WA.ui.openPopup("room1botPopup","Mr Robot : Étranger, je bloquerai l'accès à ce train jusqu'à ce que vous prouviez votre valeur. "+(i?n:o),i?[]:[{label:"Give me a clue",className:"primary",callback:()=>{G(1),l.close();const u={label:"Close",className:"primary",callback:()=>f()};WA.state.loadVariable("Room1Clue3")===!0?l=WA.ui.openPopup("room1botPopup",n,[u]):l=WA.ui.openPopup("room1botPopup","Mr Robot : Étranger, reviens vers moi si tu veux un autre indice !",[u])}}])}}),WA.room.area.onLeave("room1bot").subscribe(f),WA.room.area.onEnter("goToDriverCabine").subscribe(()=>{WA.nav.goToRoom("#driver-cabine");const i=137*32,u=16*32;WA.camera.set(i,u,500,500,!1,!0)}),WA.room.onEnterLayer("driver-cabine").subscribe(()=>{WA.state.TrainDoorOpen||(WA.controls.disablePlayerControls(),l=WA.ui.openPopup("driverCabinePopup",a,[]))}),WA.room.area.onEnter("room2bot").subscribe(()=>{WA.state.TrainStarted||(l=WA.ui.openPopup("room2botPopup","Étranger, il semble que ce train ne démarrera pas tant que vous n'aurez pas trouvé la bonne clé. "+o,[{label:"Give me a clue",className:"primary",callback:()=>G(2)}]))}),WA.room.area.onLeave("room2bot").subscribe(f),WA.room.area.onEnter("room2coffee").subscribe(()=>{l=WA.ui.openPopup("room2coffeePopup","Yous avez trouvé une tasse de café. Des études ont montré que la consommation optimale pour des adultes en bonne santé est de 3 tasses de café.",[])}),WA.room.area.onLeave("room2coffee").subscribe(f),WA.room.area.onEnter("room2pretzel").subscribe(()=>{l=WA.ui.openPopup("room2pretzelPopup","Vous avez trouvé un bretzel. Vu la taille de ce Bretzel, 1 suffit amplement au petit-déjeuner !",[])}),WA.room.area.onLeave("room2pretzel").subscribe(f),WA.room.area.onEnter("room2oldMap").subscribe(()=>{l=WA.ui.openPopup("room2oldMapPopup","Vous avez trouvé une vieille carte. C'est très rare. Il n'en existe que 8 comme celui-ci dans le monde !",[])}),WA.room.area.onLeave("room2oldMap").subscribe(f),WA.room.area.onEnter("room2coins").subscribe(()=>{l=WA.ui.openPopup("room2coinsPopup","Vous avez trouvé des pièces. 5 de plus et vous pourrez peut-être les échanger contre un billet de banque.",[])}),WA.room.area.onLeave("room2coins").subscribe(f),WA.room.onEnterLayer("teleportRoom3").subscribe(()=>{WA.state.TrainStarted&&(l=WA.ui.openPopup("teleportRoom3Popup","Maintenant que le train peut démarrer, vous pouvez passer à la salle suivante !",[{label:"Teleport",className:"primary",callback:()=>{WA.nav.goToRoom("#max-maulwurf");const i=241*32,u=27*32;WA.camera.set(i,u,500,500,!1,!0),WA.state.GameState="room3"}}]))}),WA.room.onLeaveLayer("teleportRoom3").subscribe(f),WA.room.onEnterLayer("max-maulwurf").subscribe(()=>{WA.state.TrainStarted||(WA.controls.disablePlayerControls(),l=WA.ui.openPopup("room3Popup",a,[]))}),WA.room.onLeaveLayer("max-maulwurf").subscribe(f),WA.room.area.onEnter("trainRoom3").subscribe(()=>{l=WA.ui.openPopup("room3Popup","Oups, on dirait que le train a été arrêté immédiatement ! Enquêtez sur la zone pour découvrir ce qui s'est passé 💥",[])}),WA.room.area.onLeave("trainRoom3").subscribe(f),WA.room.area.onEnter("room3bot").subscribe(()=>{WA.state.isMaxHappy||(l=WA.ui.openPopup("room3botPopup","Stranger, it seems your beloved Max Maulwurf is hungry. You will be blocked here until you comfort him. "+o,[{label:"Give me a clue",className:"primary",callback:()=>G(3)}]))}),WA.room.area.onLeave("room3bot").subscribe(f),WA.room.area.onEnter("room3helmet").subscribe(()=>{l=WA.ui.openPopup("room3helmetPopup","Vous avez trouvé le casque de travail jaune ! Cela devrait aider à calmer Max Maulwurf 🪖",[]),WA.state.helmetFound=!0}),WA.room.area.onLeave("room3helmet").subscribe(f),WA.room.area.onEnter("room3DBtrophy").subscribe(()=>{l=WA.ui.openPopup("room3DBtrophyPopup","Génial, vous avez trouvé le trophé Nexton ! Cela devrait calmer Max You Maulwurf 🏆",[]),WA.state.DBtrophyFound=!0}),WA.room.area.onLeave("room3DBtrophy").subscribe(f),WA.room.area.onEnter("room3WAmug").subscribe(()=>{l=WA.ui.openPopup("room3WAmugPopup","Vous avez trouvé la tasse à café WorkAdventure ! Cela devrait aider à calmer Max Maulwurf ☕",[]),WA.state.WAmugFound=!0}),WA.room.area.onLeave("room3WAmug").subscribe(f),WA.room.area.onEnter("maxMaulwurf").subscribe(()=>{WA.state.powerRestarted?l=WA.ui.openPopup("maxMaulwurfPopup","Un grand mercie d'avoir réparé la gare 😍",[]):WA.state.WAmugFound&&WA.state.helmetFound&&WA.state.DBtrophyFound?(WA.room.hideLayer("maxHungry"),WA.room.showLayer("maxHappy"),l=WA.ui.openPopup("maxMaulwurfPopup","Vous donnez les 3 objets à Max. Après avoir reçu tous les objets, il se calme et fait une pause en regardant son casque bien-aimé. Il se souvient de son passage à la Nexton : sa tâche principale était d'informer sur la construction et les réparations... Il s'excuse et accepte d'allumer l'alimentation électrique. Dépêchez-vous et redémarrez le système de contrôle de la circulation des trains au terminal pour éviter de nouveaux retards ! ",[]),WA.state.isMaxHappy=!0):l=WA.ui.openPopup("maxMaulwurfPopup","Max a l'air affamé... on dirait que c'est lui qui a causé les dégâts dans la centrale électrique parce qu'il est fou de ne plus être la mascotte des chemins de fer.",[])}),WA.room.area.onLeave("maxMaulwurf").subscribe(f),WA.room.area.onEnter("terminal").subscribe(()=>{WA.state.isMaxHappy?WA.state.powerRestarted?WA.nav.openCoWebSite(WA.state.formURL):l=WA.ui.openPopup("terminalPopup","Il semble que vous deviez redémarrer le système pour terminer votre mission ! 💻",[{label:"RESTART",className:"primary",callback:()=>He()}]):l=WA.ui.openPopup("terminalPopup","C'est le terminal... mais il est hors service ⛔",[])}),WA.room.area.onLeave("terminal").subscribe(()=>{Ke()}),WA.room.area.onEnter("startZone").subscribe(()=>{Z()}),WA.room.area.onLeave("startZone").subscribe(()=>{f()}),Ne().then(()=>{console.log("Scripting API Extra ready");const i=WA.state.onVariableChange("GameStarted").subscribe(u=>{u===!0&&(WA.ui.website.open(t),i.unsubscribe(),f(),WA.controls.restorePlayerControls())});WA.state.onVariableChange("TicTacToeComplete").subscribe(u=>{u===!0&&(WA.state.QuestionReady=WA.state.CigaretteComplete)}),WA.state.onVariableChange("CigaretteComplete").subscribe(u=>{u===!0&&(WA.state.QuestionReady=WA.state.TicTacToeComplete)}),WA.state.GameStarted===!1?(Z(),WA.controls.disablePlayerControls()):WA.ui.website.open(t)}).catch(i=>console.error(i))}).catch(r=>console.error(r));function Z(){l=WA.ui.openPopup("startPopup","Vous venez d'atterrir dans une gare abandonnée. En cliquant sur le bouton 'C'est parti !', le chronomètre de 20 minutes démarre. Votre mission, trouver et résoudre toutes les énigmes présentes danc cette gare. Bon chance... 🚀",[{label:"C'est parti !",className:"error",callback:()=>{WA.state.GameStarted=!0,f(),WA.controls.restorePlayerControls()}}])}function f(){l!==void 0&&(l.close(),l=void 0)}async function Ke(){f(),(await WA.nav.getCoWebSites()).length&&WA.nav.closeCoWebSite()}function G(r){let e="";for(let t=1;t<4;t++)if(e=`Room${r}Clue${t}`,WA.state.loadVariable(e)===!1){WA.state.saveVariable(e,!0);return}}function He(){f(),WA.state.powerRestarted=!0,WA.nav.openCoWebSite(WA.state.formURL)}
